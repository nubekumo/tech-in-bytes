{% extends 'base.html' %} 
{% load static %} 
{% load blog_filters %} 
{% block title %}Tech Bloggers -Home{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'css/pages/home.css' %}?v=4.0" />
<link rel="stylesheet" href="{% static 'css/pages/blog.css' %}?v=4.0" />
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
  <h1>Stay Ahead with Tech Insights</h1>
  <p>A place to share IT, AI, and Cybersecurity news and thoughts</p>
  <!-- <div class="search-container">
    <form
      action="{% url 'blog:post_list' %}"
      method="get"
      class="search-form-fa"
    >
      <input
        type="text"
        name="q"
        class="search-input-fa"
        placeholder="Search articles..."
        maxlength="100"
      />
      <button type="submit" class="search-button-fa">
        <i class="fas fa-search"></i>
      </button>
    </form>
  </div> -->
</section>

<!-- Recent Posts Section -->
<section class="recent-grid">
  <h2>Latest Posts</h2>
  <div class="grid-latest">
    {% for post in latest_posts|slice:":4" %}
    <article class="card">
      <a href="{% url 'blog:post_detail' pk=post.id slug=post.slug %}">
        {% if post.image %}
        <img
          src="{{ post.image.url }}"
          alt="{{ post.title }}"
        />
        {% else %}
        <div class="default-post-image">
          <span class="logo-text">Tech Bloggers</span>
        </div>
        {% endif %}
        <div class="card-body">
          <h4>{{ post.title }}</h4>
          <div class="meta">
            <span><i class="fas fa-user"></i>
              {% if post.author.first_name or post.author.last_name %}
                {{ post.author.first_name }} {{ post.author.last_name }}
              {% else %}
                {{ post.author.username }}
              {% endif %}
            </span>
            <span
              ><i class="fas fa-calendar"></i> {{ post.created_at|date:"M d, Y" }}</span
            >
          </div>
          <p>{{ post.content|striptags|truncatechars:140 }}</p>
          <div class="meta">
            {% for tag in post.tags.all %}
              <span class="category-tag">{{ tag.name }}</span>
            {% endfor %}
          </div>
        </div>
      </a>
    </article>
    {% endfor %}
  </div>

  <h2 class="side-post-title">Recently Posted</h2>
  <div class="side-posts">
    {% for post in recently_posted %}
    <article class="side-post">
      <a href="{% url 'blog:post_detail' pk=post.id slug=post.slug %}">
        {% if post.image %}
        <img
          src="{{ post.image.url }}"
          alt="{{ post.title }}"
        />
        {% else %}
        <div class="default-post-image">
          <span class="logo-text">Tech Bloggers</span>
        </div>
        {% endif %}
        <div class="side-post-text">
          <h4>{{ post.title }}</h4>
          <div class="meta">
            <span><i class="fas fa-user"></i>
              {% if post.author.first_name or post.author.last_name %}
                {{ post.author.first_name }} {{ post.author.last_name }}
              {% else %}
                {{ post.author.username }}
              {% endif %}
            </span>
            <span
              ><i class="fas fa-calendar"></i> {{ post.created_at|date:"M d, Y" }}</span
            >
          </div>
          <p class="side-post-text">{{ post.content|safe_truncatewords:20 }}</p>
        </div>
      </a>
    </article>
    {% endfor %}
  </div>

  <h2 class="side-post-title most">Most Commented</h2>
  <div class="side-posts most">
    {% for post in most_commented %}
    <article class="side-post">
      <a href="{% url 'blog:post_detail' pk=post.id slug=post.slug %}">
        {% if post.image %}
        <img
          src="{{ post.image.url }}"
          alt="{{ post.title }}"
        />
        {% else %}
        <div class="default-post-image">
          <span class="logo-text">Tech Bloggers</span>
        </div>
        {% endif %}
        <div class="side-post-text">
          <h4>{{ post.title }}</h4>
          <div class="meta">
            <span><i class="fas fa-user"></i>
              {% if post.author.first_name or post.author.last_name %}
                {{ post.author.first_name }} {{ post.author.last_name }}
              {% else %}
                {{ post.author.username }}
              {% endif %}
            </span>
            <span
              ><i class="fas fa-comments"></i> {{ post.top_level_comment_count }}
              comments</span
            >
          </div>
          <p class="side-post-text">{{ post.content|safe_truncatewords:20 }}</p>
        </div>
      </a>
    </article>
    {% endfor %}
  </div>
</section>

<!-- (Most Commented moved inside the first recent-grid above) -->

<!-- Most Liked Posts Section -->
<section class="recommended">
  <h2>Most Liked Posts</h2>
  <div class="grid-recommended">
    {% for post in recommended_posts %}
    <article class="recom-card card">
      <a href="{% url 'blog:post_detail' pk=post.id slug=post.slug %}">
        {% if post.image %}
        <img
          src="{{ post.image.url }}"
          alt="{{ post.title }}"
        />
        {% else %}
        <div class="default-post-image">
          <span class="logo-text">Tech Bloggers</span>
        </div>
        {% endif %}
        <div class="card-body">
          <h4>{{ post.title }}</h4>
          <div class="meta">
            <span
              ><i class="fas fa-user"></i> {{ post.author.get_full_name|default:post.author.username }}</span
            >
            <span
              ><i class="fas fa-calendar"></i> {{ post.created_at|date:"M d, Y" }}</span
            >
            <span
              ><i class="fas fa-heart"></i> {{ post.likes.count }} likes</span
            >
          </div>
          <p>{{ post.content|safe_truncatewords:20 }}</p>
          <div class="meta">
            {% for tag in post.tags.all %}
              <span class="category-tag">{{ tag.name }}</span>
            {% endfor %}
          </div>
        </div>
      </a>
    </article>
    {% endfor %}
  </div>
  <div class="go-to-all-btn-container">
    <a href="{% url 'blog:post_list' %}" class="btn btn--primary"
      >View All Posts</a
    >
  </div>
</section>
{% endblock %}
