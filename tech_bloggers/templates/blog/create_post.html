{% extends 'base.html' %} 
{% load static %} 
{% block title %}Create Post - Tech-In-Bytes{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'css/pages/blog.css' %}?v={{ STATIC_VERSION }}" />
<link rel="stylesheet" href="{% static 'css/vendors/tinymce.css' %}?v={{ STATIC_VERSION }}" />
{% endblock %}

{% block extra_css %}
<!-- WYSIWYG Editor CSS will be added here in the future -->
{% endblock %} 

{% block content %}
<!-- Create Post Section -->
<div class="container create-post-container">
  <form
    class="create-post-form"
    method="post"
    enctype="multipart/form-data"
    action="{% url 'blog:post_create' %}"
  >
    {% csrf_token %}

    <!-- Post Section -->
    <div class="form-section">
      <h1 class="form-heading">Write an Awesome Post</h1>

      {% if form.non_field_errors %}
      <div class="alert alert-error">
        <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
          <i class="fas fa-exclamation-triangle" style="color: #f85149; margin-top: 0.125rem; flex-shrink: 0;"></i>
          <div>
            {% for error in form.non_field_errors %}
              <p style="margin: 0; font-weight: 500;">{{ error }}</p>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Tags Selection -->
      <div class="form-group">
        <label for="tags">Tags</label>
        <div class="tag-selector">
          <!-- Tags Selection -->
          <div class="available-tags-container">
            <div class="available-tags-label">Choose up to 3 tags:</div>
            <div class="available-tags-list" id="available-tags-list">
              {% for tag in form.available_tags.field.queryset %}
              <span class="available-tag" data-tag-id="{{ tag.id }}" data-tag-name="{{ tag.name }}">
                {{ tag.name }}
              </span>
              {% endfor %}
            </div>
          </div>
          
          <!-- Hidden input for form submission -->
          <input type="hidden" name="tags_input" id="tags-hidden-input" value="{% if form.tags_input.value %}{{ form.tags_input.value }}{% endif %}">
        </div>
        {% if form.tags_input.errors %}
        <div class="form-error">{{ form.tags_input.errors }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.title.id_for_label }}">Post Title</label>
        {{ form.title }}
        {% if form.title.errors %}
        <div class="form-error">{{ form.title.errors }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.content.id_for_label }}">Post Content</label>
        {{ form.content }}
      </div>
    </div>

    <!-- Post Summary Section -->
    <div class="form-section">
      <div class="form-group">
        <label for="{{ form.summary.id_for_label }}">Post Summary</label>
        {{ form.summary }}
        {% if form.summary.errors %}
        <div class="form-error">{{ form.summary.errors }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Post Image Section -->
    <div class="form-section">
      <label for="image">Post Image</label>
      <div class="image-container">
        <div class="image-placeholder" id="imagePreview">
          {% if form.image.value %}
          <img src="{{ form.image.value.url }}" alt="Post image preview" />
          {% else %} Image Preview {% endif %}
        </div>
      </div>
      <div class="image-actions">
        <input
          type="file"
          id="image"
          name="image"
          accept="image/*"
          class="hidden-file-input"
          {% if form.image.field.required %}required{% endif %}
        />
        <button type="button" class="btn btn--outline" id="uploadImage">
          Upload Image
        </button>
        {% if form.image.errors %}
        <div class="form-error">{{ form.image.errors }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Save Post -->
    <div class="form-actions">
      <button
        type="submit"
        name="action"
        value="draft"
        class="btn btn--outline"
      >
        Save as Draft
      </button>
      <button
        type="submit"
        name="action"
        value="publish"
        class="btn btn--primary"
      >
        Publish Post
      </button>
    </div>
  </form>
</div>

{% endblock %}

{% block extra_js %}
<!-- TinyMCE 6 with built-in code highlighting -->
<script src="https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js"></script>
<script>
  window.__USE_TINYMCE_FOR_CONTENT__ = true;
</script>
{% endblock %}
