{% extends 'base.html' %} 
{% load static %} 
{% block title %}Edit Post - Tech Bloggers{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'css/pages/blog.css' %}?v=4.0" />
<link rel="stylesheet" href="{% static 'css/vendors/tinymce.css' %}?v=4.0" />
{% endblock %}

{% block extra_css %}
<!-- WYSIWYG Editor CSS will be added here in the future -->
{% endblock %} 

{% block content %}
<!-- Edit Post Section -->
<div class="container create-post-container">
  <form
    class="create-post-form"
    method="post"
    enctype="multipart/form-data"
  >
    {% csrf_token %}

    <!-- Post Section -->
    <div class="form-section">
      <h1 class="form-heading">Edit Your Post</h1>

      {% if form.non_field_errors %}
      <div class="alert alert-error">
        {% for error in form.non_field_errors %}
        <p>{{ error }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Tags Selection -->
      <div class="form-group">
        <label for="tags">Tags</label>
        <div class="tag-selector">
          <!-- Tags Selection -->
          <div class="available-tags-container">
            <div class="available-tags-label">Choose up to 3 tags:</div>
            <div class="available-tags-list" id="available-tags-list">
              {% for tag in form.available_tags.field.queryset %}
              <span class="available-tag" data-tag-id="{{ tag.id }}" data-tag-name="{{ tag.name }}">
                {{ tag.name }}
              </span>
              {% endfor %}
            </div>
          </div>
          
          <!-- Hidden input for form submission -->
          <input type="hidden" name="tags_input" id="tags-hidden-input" value="{% if form.tags_input.value %}{{ form.tags_input.value }}{% endif %}">
        </div>
        {% if form.tags_input.errors %}
        <div class="form-error">{{ form.tags_input.errors }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.title.id_for_label }}">Post Title</label>
        {{ form.title }}
        {% if form.title.errors %}
        <div class="form-error">{{ form.title.errors }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.content.id_for_label }}">Post Content</label>
        {{ form.content }}
        {% if form.content.errors %}
        <div class="form-error">{{ form.content.errors }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Post Summary Section -->
    <div class="form-section">
      <div class="form-group">
        <label for="{{ form.summary.id_for_label }}">Post Summary</label>
        {{ form.summary }}
        {% if form.summary.errors %}
        <div class="form-error">{{ form.summary.errors }}</div>
        {% endif %}
      </div>
      <button type="button" class="btn btn--primary" id="generateSummary">
        Generate Summary with AI
      </button>
    </div>

    <!-- Post Image Section -->
    <div class="form-section">
      <label for="image">Post Image</label>
      <div class="image-container">
        <div class="image-placeholder" id="imagePreview">
          {% if form.instance.image %}
          <img src="{{ form.instance.image.url }}" alt="Current post image" />
          {% else %}
          Image Preview
          {% endif %}
        </div>
      </div>
      <div class="image-actions">
        <input
          type="file"
          id="image"
          name="image"
          accept="image/*"
          class="hidden-file-input"
        />
        <button type="button" class="btn btn--outline" id="uploadImage">
          {% if form.instance.image %}Change Image{% else %}Upload Image{% endif %}
        </button>
        {% if form.image.errors %}
        <div class="form-error">{{ form.image.errors }}</div>
        {% endif %}
        <span class="or">or</span>
        <button type="button" class="btn btn--primary" id="generateImage">
          Generate with AI
        </button>
      </div>
    </div>

    <!-- Update Post -->
    <div class="form-actions">
      <button type="submit" class="btn btn--primary">
        Update Post
      </button>
      <a href="{% url 'blog:post_manage' %}" class="btn btn--outline">
        Cancel
      </a>
    </div>
  </form>
</div>

{% endblock %}

{% block extra_js %}
<!-- TinyMCE 6 with built-in code highlighting -->
<script src="https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js"></script>
<script>
  window.__USE_TINYMCE_FOR_CONTENT__ = true;
</script>
{% endblock %}
